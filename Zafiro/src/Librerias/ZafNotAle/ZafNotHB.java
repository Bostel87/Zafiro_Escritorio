/*
 * ZafNotHB.java 
 *
 * Created on Nov 10 2016, 16:00 PM
 */
package Librerias.ZafNotAle;
import Librerias.ZafParSis.ZafParSis;
import Librerias.ZafUtil.ZafUtil;
import java.sql.*;


/**
 *
 * @author sistemas9
 */
public class ZafNotHB extends javax.swing.JDialog 
{
    private ZafParSis objParSis;   
    private ZafUtil objUti;
    private Connection con;
    private Statement stm;
    private ResultSet rst;
    private String strAux, strSQL; 
    private String strVersion = " v0.1.02";
    javax.swing.JDesktopPane dskGen;

    /**
     * Creates new form ZafNotHB
     */
    public ZafNotHB(java.awt.Frame parent, boolean modal, ZafParSis obj, javax.swing.JDesktopPane dskGe) 
    {
        super(parent, modal);
        objParSis = obj;
        initComponents();
        dskGen=dskGe;
        configurarVentana();
    }

    /**
     * Configurar la ventana de notificación.
     */
    private boolean configurarVentana() 
    {
        strAux = "Happy Birthday";
        this.setTitle(strAux+strVersion);
        
        return true;
    }
   
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        panHB = new javax.swing.JPanel();
        panImg = new javax.swing.JPanel()
        {
            /*Pasos para agregar código para poner imagen de fondo en un JPanel:
            1) En NetBeans seleccionar el JPanel.
        2) Ir a la ventana de Propiedades y elegir "Code".
    3) Dar click en el botón de la propiedad "Custom Creation Code".
    4) Digitar/Pegar las líneas de código.
    */
    @Override
    public void paint(java.awt.Graphics g)
    {
        java.awt.Dimension dimTam=getSize();
        javax.swing.ImageIcon imgFon=new javax.swing.ImageIcon(getClass().getResource("/Recursos/Imagenes/fondo_happybirthday.jpg"));
        g.drawImage(imgFon.getImage(), 0, 0, dimTam.width, dimTam.height, null);
        setOpaque(false);
        super.paint(g);
    }
    };

    setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);

    panHB.setLayout(new java.awt.BorderLayout());

    panImg.setBackground(new java.awt.Color(0, 102, 102));
    panImg.setBorder(javax.swing.BorderFactory.createMatteBorder(2, 2, 2, 2, new java.awt.Color(0, 204, 204)));
    panImg.setForeground(new java.awt.Color(51, 51, 51));
    panImg.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
    panImg.setPreferredSize(new java.awt.Dimension(200, 320));
    panImg.setLayout(new java.awt.BorderLayout());
    panHB.add(panImg, java.awt.BorderLayout.CENTER);

    getContentPane().add(panHB, java.awt.BorderLayout.CENTER);

    java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
    setBounds((screenSize.width-1148)/2, (screenSize.height-560)/2, 1148, 560);
    }// </editor-fold>//GEN-END:initComponents



    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel panHB;
    private javax.swing.JPanel panImg;
    // End of variables declaration//GEN-END:variables

    /**
     * 
     * @param intCodUsr
     * @return 
     */
    public boolean isUsrHappyBirthday(int intCodUsr)
    {
        boolean blnRes=false;
        try
        {
            con=DriverManager.getConnection(objParSis.getStringConexion(), objParSis.getUsuarioBaseDatos(), objParSis.getClaveBaseDatos());
            if (con!=null)
            {
                stm=con.createStatement();
                //Armar la sentencia SQL.
                if(objParSis.getCodigoUsuario()==1)
                {
                    strSQL="";
                    strSQL+=" SELECT x.* FROM ( ";
                    strSQL+="    SELECT a1.co_dep, a1.co_emp, emp.tx_nom as NomEmp, a.co_tra, a.tx_ide, (a.tx_nom ||' '|| a.tx_ape) as NomTra, /*a.fe_nac,*/ a.tx_Sex ";
                    strSQL+="           ,CASE WHEN a.co_Tra=530 THEN '1987-06-28' ELSE a.fe_nac END as fe_nac ";
                    strSQL+="           ,CASE WHEN a1.co_tra=19 THEN '172.16.8.5' ";          //Ing. Eddye Lino
                    strSQL+="            ELSE CASE WHEN a1.co_tra=20 THEN '172.16.8.8' ";     //Ingrid
                    strSQL+="            ELSE CASE WHEN a1.co_tra=182 THEN '172.16.8.111' ";  //Jose Mario
                    strSQL+="            ELSE CASE WHEN a1.co_tra=349 THEN '172.16.8.114' ";  //Rose
                    strSQL+="            ELSE CASE WHEN a1.co_tra=530 THEN '172.16.8.62'  ";  //Sandra  
                    strSQL+="            ELSE CASE WHEN a1.co_tra=444 THEN '172.16.8.110' ";  //Mateo
                    strSQL+="            ELSE CASE WHEN a1.co_tra=554 THEN '172.16.8.44'  ";  //Tony
                    strSQL+="            ELSE CASE WHEN a1.co_tra=248 THEN '172.16.8.112' ";  //Dennis
                    strSQL+="            ELSE '0' END END END END END END END END AS tx_dirIp ";
                    strSQL+="    FROM tbm_tra as a";
                    strSQL+="    INNER JOIN tbm_traEmp as a1 ON (a1.co_Tra=a.co_tra)";
                    strSQL+="    INNER JOIN tbm_emp as emp ON (emp.co_Emp=a1.co_emp)";
                    strSQL+="    WHERE a1.st_Reg='A'";
                    strSQL+="    AND a1.co_dep=21";
                    strSQL+="    ORDER BY a1.co_tra ";
                    strSQL+=" ) as x";
                    strSQL+=" WHERE tx_dirIp ='"+objParSis.getDireccionIP()+"'";
                    strSQL+=" AND EXTRACT(MONTH from x.fe_nac) = EXTRACT(MONTH from current_date) ";
                    strSQL+=" AND EXTRACT(DAY from x.fe_nac) = EXTRACT(DAY from current_date) ";
                }
                else
                {
                    strSQL="";
                    strSQL+=" SELECT a1.co_emp, emp.tx_nom as NomEmp, a.co_tra, a.tx_ide, (a.tx_nom ||' '|| a.tx_ape) as NomTra, a.fe_nac, a.tx_Sex, ";
                    strSQL+="        usr.co_usr, usr.tx_usr ";
                    strSQL+=" FROM tbm_tra as a ";
                    strSQL+=" INNER JOIN tbm_traEmp as a1 ON (a1.co_Tra=a.co_tra) ";
                    strSQL+=" INNER JOIN tbm_emp as emp ON (emp.co_Emp=a1.co_emp) ";
                    strSQL+=" INNER JOIN tbm_usr as usr ON (usr.tx_ced=a.tx_ide) ";
                    strSQL+=" WHERE a1.st_Reg='A' ";
                    strSQL+=" AND EXTRACT(MONTH from a.fe_nac) = EXTRACT(MONTH from current_date) ";
                    strSQL+=" AND EXTRACT(DAY from a.fe_nac) = EXTRACT(DAY from current_date)";
                    strSQL+=" AND usr.co_usr="+intCodUsr;
                    //strSQL+=" AND "+intCodUsr+"=24";  //Solo lsensi
                }
                //System.out.println("getUsuarioHappyBirthday: "+strSQL);
                rst=stm.executeQuery(strSQL);
                if (rst.next())
                {
                    blnRes=true;
                }
                rst.close();
                stm.close();
                con.close();
                rst=null;
                stm=null;
                con=null;
            }
        }
        catch (java.sql.SQLException e)
        {
            blnRes=false;
            objUti.mostrarMsgErr_F1(null, e);
        }
        catch (Exception e)
        {
            blnRes=false;
            objUti.mostrarMsgErr_F1(null, e);
        }
        return blnRes;
    }
    
    
}
