/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * ZafHer04.java
 *
 * Created on Jul 20, 2010, 10:40:39 AM
 */

package Herramientas.ZafHer04;

import Librerias.ZafUtil.ZafUtil; /**/
import java.util.Vector; /**/
import Librerias.ZafVenCon.ZafVenCon;
import java.util.ArrayList;

/**
 *
 * @author jayapata
 */
public class ZafHer04 extends javax.swing.JInternalFrame {

    Librerias.ZafParSis.ZafParSis objZafParSis;
    ZafUtil objUti; /**/
    private Librerias.ZafTblUti.ZafTblMod.ZafTblMod objTblMod; /**/
    private Librerias.ZafTblUti.ZafTblCelRenLbl.ZafTblCelRenLbl objTblCelRenLbl;
    private Librerias.ZafTblUti.ZafTblCelEdiTxt.ZafTblCelEdiTxt objTblCelEdiTxt;
    private ZafThreadGUI objThrGUI;
    ZafVenCon objVenConEmp;
    Librerias.ZafInventario.ZafInvItm objInvItm;

    String strCodEmp="";
    String strNomEmp="";
    String strVersion=" Ver 0.3 ";

    final int INT_TBL_LINEA=0;  // NUMERO DE LINEAS
    final int INT_TBL_CODEMP=1; // CODIGO DE EMPRESA
    final int INT_TBL_NOMEMP=2;  // NOMBRE DE EMPRESA
    final int INT_TBL_CODLOC=3;  // CODIGO DE LOCAL
    final int INT_TBL_NOMLOC=4;  // NOMBRE DE LOCAL
    final int INT_TBL_DIAVAL=5;  // DIAS DE VALIDEZ

    Vector vecCab=new Vector();    //Almacena las cabeceras  /**/

    /** Creates new form ZafHer04 */
    public ZafHer04(Librerias.ZafParSis.ZafParSis obj) {
       try{ /**/
	    this.objZafParSis = (Librerias.ZafParSis.ZafParSis) obj.clone();
	    initComponents();

            objInvItm=new Librerias.ZafInventario.ZafInvItm(this, objZafParSis);

            this.setTitle(objZafParSis.getNombreMenu()+" "+ strVersion ); /**/
            lblTit.setText(objZafParSis.getNombreMenu());  /**/

	    objUti = new ZafUtil(); /**/
	  
	 }catch (CloneNotSupportedException e){  objUti.mostrarMsgErr_F1(this, e); }  /**/
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel3 = new javax.swing.JPanel();
        jPanel5 = new javax.swing.JPanel();
        butCon = new javax.swing.JButton();
        butgua = new javax.swing.JButton();
        butcerr = new javax.swing.JButton();
        panBarEst = new javax.swing.JPanel();
        lblMsgSis = new javax.swing.JLabel();
        panPrgSis = new javax.swing.JPanel();
        pgrSis = new javax.swing.JProgressBar();
        panCen = new javax.swing.JPanel();
        tabGen = new javax.swing.JTabbedPane();
        panGenTabGen = new javax.swing.JPanel();
        panCabRecChq = new javax.swing.JPanel();
        jLabel3 = new javax.swing.JLabel();
        txtCodEmp = new javax.swing.JTextField();
        txtNomEmp = new javax.swing.JTextField();
        butEmp = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();
        spnDiaVal = new javax.swing.JSpinner();
        jButton1 = new javax.swing.JButton();
        jPanel1 = new javax.swing.JPanel();
        spnDat = new javax.swing.JScrollPane();
        tblDat = new javax.swing.JTable();
        panNor = new javax.swing.JPanel();
        lblTit = new javax.swing.JLabel();

        setClosable(true);
        setDefaultCloseOperation(javax.swing.WindowConstants.DO_NOTHING_ON_CLOSE);
        setIconifiable(true);
        setMaximizable(true);
        setResizable(true);
        addInternalFrameListener(new javax.swing.event.InternalFrameListener() {
            public void internalFrameActivated(javax.swing.event.InternalFrameEvent evt) {
            }
            public void internalFrameClosed(javax.swing.event.InternalFrameEvent evt) {
            }
            public void internalFrameClosing(javax.swing.event.InternalFrameEvent evt) {
                formInternalFrameClosing(evt);
            }
            public void internalFrameDeactivated(javax.swing.event.InternalFrameEvent evt) {
            }
            public void internalFrameDeiconified(javax.swing.event.InternalFrameEvent evt) {
            }
            public void internalFrameIconified(javax.swing.event.InternalFrameEvent evt) {
            }
            public void internalFrameOpened(javax.swing.event.InternalFrameEvent evt) {
                formInternalFrameOpened(evt);
            }
        });

        jPanel3.setLayout(new java.awt.BorderLayout());

        butCon.setFont(new java.awt.Font("SansSerif", 0, 11));
        butCon.setText("Consultar");
        butCon.setPreferredSize(new java.awt.Dimension(90, 23));
        butCon.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                butConActionPerformed(evt);
            }
        });
        jPanel5.add(butCon);

        butgua.setFont(new java.awt.Font("SansSerif", 0, 11));
        butgua.setText("Guardar");
        butgua.setPreferredSize(new java.awt.Dimension(90, 23));
        butgua.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                butguaActionPerformed(evt);
            }
        });
        jPanel5.add(butgua);

        butcerr.setFont(new java.awt.Font("SansSerif", 0, 11));
        butcerr.setText("Cerrar");
        butcerr.setPreferredSize(new java.awt.Dimension(90, 23));
        butcerr.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                butcerrActionPerformed(evt);
            }
        });
        jPanel5.add(butcerr);

        jPanel3.add(jPanel5, java.awt.BorderLayout.EAST);

        panBarEst.setPreferredSize(new java.awt.Dimension(320, 19));
        panBarEst.setLayout(new java.awt.BorderLayout());

        lblMsgSis.setText("Listo");
        lblMsgSis.setBorder(javax.swing.BorderFactory.createEtchedBorder(javax.swing.border.EtchedBorder.RAISED));
        panBarEst.add(lblMsgSis, java.awt.BorderLayout.CENTER);

        panPrgSis.setBorder(javax.swing.BorderFactory.createEtchedBorder(javax.swing.border.EtchedBorder.RAISED));
        panPrgSis.setMinimumSize(new java.awt.Dimension(24, 26));
        panPrgSis.setPreferredSize(new java.awt.Dimension(200, 15));
        panPrgSis.setLayout(new java.awt.BorderLayout(2, 2));

        pgrSis.setBorder(javax.swing.BorderFactory.createEtchedBorder(javax.swing.border.EtchedBorder.RAISED));
        pgrSis.setBorderPainted(false);
        pgrSis.setDebugGraphicsOptions(javax.swing.DebugGraphics.NONE_OPTION);
        pgrSis.setPreferredSize(new java.awt.Dimension(100, 16));
        panPrgSis.add(pgrSis, java.awt.BorderLayout.CENTER);

        panBarEst.add(panPrgSis, java.awt.BorderLayout.EAST);

        jPanel3.add(panBarEst, java.awt.BorderLayout.SOUTH);

        getContentPane().add(jPanel3, java.awt.BorderLayout.SOUTH);

        panCen.setLayout(new java.awt.BorderLayout());

        panGenTabGen.setLayout(new java.awt.BorderLayout());

        panCabRecChq.setPreferredSize(new java.awt.Dimension(100, 70));
        panCabRecChq.setLayout(null);

        jLabel3.setFont(new java.awt.Font("SansSerif", 0, 11));
        jLabel3.setText("Empresa:"); // NOI18N
        panCabRecChq.add(jLabel3);
        jLabel3.setBounds(5, 4, 70, 20);

        txtCodEmp.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtCodEmpActionPerformed(evt);
            }
        });
        txtCodEmp.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txtCodEmpFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtCodEmpFocusLost(evt);
            }
        });
        panCabRecChq.add(txtCodEmp);
        txtCodEmp.setBounds(60, 5, 60, 20);

        txtNomEmp.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtNomEmpActionPerformed(evt);
            }
        });
        txtNomEmp.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txtNomEmpFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtNomEmpFocusLost(evt);
            }
        });
        panCabRecChq.add(txtNomEmp);
        txtNomEmp.setBounds(120, 5, 200, 20);

        butEmp.setText(".."); // NOI18N
        butEmp.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                butEmpActionPerformed(evt);
            }
        });
        panCabRecChq.add(butEmp);
        butEmp.setBounds(320, 5, 20, 20);

        jLabel1.setFont(new java.awt.Font("SansSerif", 0, 11)); // NOI18N
        jLabel1.setText("Validez:");
        panCabRecChq.add(jLabel1);
        jLabel1.setBounds(5, 30, 60, 15);
        panCabRecChq.add(spnDiaVal);
        spnDiaVal.setBounds(60, 28, 70, 20);

        jButton1.setFont(new java.awt.Font("SansSerif", 0, 11)); // NOI18N
        jButton1.setText("Asignar");
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });
        panCabRecChq.add(jButton1);
        jButton1.setBounds(135, 28, 80, 20);

        panGenTabGen.add(panCabRecChq, java.awt.BorderLayout.NORTH);

        jPanel1.setLayout(new java.awt.BorderLayout());

        tblDat.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        spnDat.setViewportView(tblDat);

        jPanel1.add(spnDat, java.awt.BorderLayout.CENTER);

        panGenTabGen.add(jPanel1, java.awt.BorderLayout.CENTER);

        tabGen.addTab("General", panGenTabGen);

        panCen.add(tabGen, java.awt.BorderLayout.CENTER);

        getContentPane().add(panCen, java.awt.BorderLayout.CENTER);

        panNor.setLayout(new java.awt.BorderLayout());

        lblTit.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        lblTit.setText("titulo"); // NOI18N
        panNor.add(lblTit, java.awt.BorderLayout.CENTER);

        getContentPane().add(panNor, java.awt.BorderLayout.NORTH);

        java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
        setBounds((screenSize.width-700)/2, (screenSize.height-450)/2, 700, 450);
    }// </editor-fold>//GEN-END:initComponents


private boolean configurarVenConEmp() {
 boolean blnRes=true;
 try {
    ArrayList arlCam=new ArrayList();
    arlCam.add("a.co_emp");
    arlCam.add("a.tx_nom");

    ArrayList arlAli=new ArrayList();
    arlAli.add("Código");
    arlAli.add("Nom.Emp.");

    ArrayList arlAncCol=new ArrayList();
    arlAncCol.add("80");
    arlAncCol.add("460");

    //Armar la sentencia SQL.   a7.nd_stkTot,
    String Str_Sql="";

//     if(objZafParSis.getCodigoUsuario()==1){
//      Str_Sql="select a.co_emp, a.tx_nom from tbm_emp as a where a.co_emp not in (0,3) order by a.co_emp ";
//     }else{
         if(objZafParSis.getCodigoEmpresa()==objZafParSis.getCodigoEmpresaGrupo())
            Str_Sql="select a.co_emp, a.tx_nom from tbm_emp as a where a.co_emp not in (0,3) order by a.co_emp ";
         else
            Str_Sql="select a.co_emp, a.tx_nom from tbm_emp as a where a.co_emp = "+objZafParSis.getCodigoEmpresa()+" order by a.co_emp ";
   //  }

    objVenConEmp=new ZafVenCon(javax.swing.JOptionPane.getFrameForComponent(this), objZafParSis, objZafParSis.getNombreMenu(), Str_Sql, arlCam, arlAli, arlAncCol);
    arlCam=null;
    arlAli=null;
    arlAncCol=null;

 }catch (Exception e) {  blnRes=false;  objUti.mostrarMsgErr_F1(this, e); }
 return blnRes;
}


/**
 * Carga ventanas de consulta y configuracion de la tabla
 */
public void Configura_ventana_consulta(){

    configurarVenConEmp();
    
    Configurartabla();
}


private boolean Configurartabla() {
 boolean blnRes=false;
 try{
     //Configurar JTable: Establecer el modelo.
        vecCab.clear();
        vecCab.add(INT_TBL_LINEA,"");
        vecCab.add(INT_TBL_CODEMP,"Cód.Emp.");
        vecCab.add(INT_TBL_NOMEMP,"Nom.Emp");
        vecCab.add(INT_TBL_CODLOC,"Cód.Loc.");
        vecCab.add(INT_TBL_NOMLOC,"Nom.Loc.");
        vecCab.add(INT_TBL_DIAVAL,"Validez.");
        
	objTblMod=new Librerias.ZafTblUti.ZafTblMod.ZafTblMod();
        objTblMod.setHeader(vecCab);
        tblDat.setModel(objTblMod);

        //Configurar JTable: Establecer tipo de selección.
        tblDat.setRowSelectionAllowed(true);
        tblDat.setSelectionMode(javax.swing.ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);
        new Librerias.ZafColNumerada.ZafColNumerada(tblDat,INT_TBL_LINEA);

        //Configurar JTable: Mostrar ToolTipText en la cabecera de las columnas.
       //* objMouMotAda=new ZafMouMotAda();
        //*tblDat.getTableHeader().addMouseMotionListener(objMouMotAda);


        tblDat.getTableHeader().setReorderingAllowed(false);

	//Configurar JTable: Establecer el tipo de redimensionamiento de las columnas.
        tblDat.setAutoResizeMode(javax.swing.JTable.AUTO_RESIZE_OFF);  /**/
        javax.swing.table.TableColumnModel tcmAux=tblDat.getColumnModel();  /**/

        objTblMod.setColumnDataType(INT_TBL_DIAVAL, objTblMod.INT_COL_DBL, new Integer(0), null);


        Vector vecAux=new Vector();
        vecAux.add("" + INT_TBL_DIAVAL);
        objTblMod.setColumnasEditables(vecAux);
        vecAux=null;

        new Librerias.ZafTblUti.ZafTblEdi.ZafTblEdi(tblDat);


        objTblCelRenLbl=new Librerias.ZafTblUti.ZafTblCelRenLbl.ZafTblCelRenLbl();
        objTblCelRenLbl.setBackground(objZafParSis.getColorCamposObligatorios());
        objTblCelRenLbl.setHorizontalAlignment(javax.swing.JLabel.RIGHT);
        objTblCelRenLbl.setTipoFormato(objTblCelRenLbl.INT_FOR_NUM);
        objTblCelRenLbl.setFormatoNumerico(objZafParSis.getFormatoNumero(),false,true);
        tcmAux.getColumn(INT_TBL_DIAVAL).setCellRenderer(objTblCelRenLbl);
        objTblCelRenLbl=null;


        objTblCelEdiTxt=new Librerias.ZafTblUti.ZafTblCelEdiTxt.ZafTblCelEdiTxt(tblDat);
        tcmAux.getColumn(INT_TBL_DIAVAL).setCellEditor(objTblCelEdiTxt);
        objTblCelEdiTxt.addTableEditorListener(new Librerias.ZafTblUti.ZafTblEvt.ZafTableAdapter() {
            public void beforeEdit(Librerias.ZafTblUti.ZafTblEvt.ZafTableEvent evt){
                

            }
            public void afterEdit(Librerias.ZafTblUti.ZafTblEvt.ZafTableEvent evt) {


             }
        });

         //Tamaño de las celdas
        tcmAux.getColumn(INT_TBL_LINEA).setPreferredWidth(25);
        tcmAux.getColumn(INT_TBL_CODEMP).setPreferredWidth(80);
        tcmAux.getColumn(INT_TBL_NOMEMP).setPreferredWidth(120);
        tcmAux.getColumn(INT_TBL_CODLOC).setPreferredWidth(80);
        tcmAux.getColumn(INT_TBL_NOMLOC).setPreferredWidth(300);
        tcmAux.getColumn(INT_TBL_DIAVAL).setPreferredWidth(60);
      

     tcmAux=null;
     setEditable(true);





      blnRes=true;
   }catch(Exception e) {  blnRes=false;   objUti.mostrarMsgErr_F1(this,e);  }
    return blnRes;
}


public void setEditable(boolean editable) {
  if (editable==true){
    objTblMod.setModoOperacion(objTblMod.INT_TBL_EDI);

 }else{  objTblMod.setModoOperacion(objTblMod.INT_TBL_NO_EDI); }
}


private boolean validar(){
  boolean blnRes=false;
  try{


     if(txtCodEmp.getText().equals("")){
         this.MensajeInf("ESCOJA LA EMPRESA PARA LA BUSQUEDA ");
         blnRes=true;
      }

    
  }catch(Exception evt ){ objUti.mostrarMsgErr_F1(this, evt); }
  return blnRes;
}

   private void MensajeInf(String strMensaje){
        javax.swing.JOptionPane obj =new javax.swing.JOptionPane();
        String strTit;
        strTit="Mensaje del sistema Zafiro";
        obj.showMessageDialog(this,strMensaje,strTit,javax.swing.JOptionPane.INFORMATION_MESSAGE);
    }



    private void butConActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_butConActionPerformed
        // TODO add your handling code here:

       if(!validar()){
            if (objThrGUI==null) {
                objThrGUI=new ZafThreadGUI();
                objThrGUI.start();
            }
        }

    }//GEN-LAST:event_butConActionPerformed


private class ZafThreadGUI extends Thread
{
 public void run(){

    lblMsgSis.setText("Obteniendo datos...");
    pgrSis.setIndeterminate(true);

     String strSql="";
     
      strSql="select a.co_emp, a.tx_nom as nomemp, a1.co_loc, a1.tx_nom, a1.ne_diavalcotven  from tbm_emp as a " +
      " inner join tbm_loc as a1 on (a1.co_emp=a.co_emp) where a.co_emp="+txtCodEmp.getText()+"  order by a1.co_loc ";

     cargarDat(strSql);


   objThrGUI=null;
}
}

/**
 * Se encarga de cargar la informacion en la tabla
 * @return  true si esta correcto y false  si hay algun error
 */
private boolean cargarDat(String strSql){
  boolean blnRes=false;
  java.sql.Connection conn;
  java.sql.Statement stmLoc;
  java.sql.ResultSet rstLoc;
   try{
      conn=java.sql.DriverManager.getConnection(objZafParSis.getStringConexion(), objZafParSis.getUsuarioBaseDatos(), objZafParSis.getClaveBaseDatos() );
      if(conn!=null){
           stmLoc=conn.createStatement();
           java.util.Vector vecData = new java.util.Vector();

           rstLoc=stmLoc.executeQuery(strSql);
           while(rstLoc.next()){

               java.util.Vector vecReg = new java.util.Vector();
                vecReg.add(INT_TBL_LINEA, "");
                vecReg.add(INT_TBL_CODEMP, rstLoc.getString("co_emp") );
                vecReg.add(INT_TBL_NOMEMP, rstLoc.getString("nomemp") );
                vecReg.add(INT_TBL_CODLOC, rstLoc.getString("co_loc") );
                vecReg.add(INT_TBL_NOMLOC, rstLoc.getString("tx_nom") );
                vecReg.add(INT_TBL_DIAVAL, rstLoc.getString("ne_diavalcotven") );

               vecData.add(vecReg);
           }
           rstLoc.close();
           rstLoc=null;

           objTblMod.setData(vecData);
           tblDat .setModel(objTblMod);
        
        lblMsgSis.setText("Listo");
        pgrSis.setValue(0);
        pgrSis.setIndeterminate(false);

      stmLoc.close();
      stmLoc=null;
      conn.close();
      conn=null;

   }}catch(java.sql.SQLException Evt) { blnRes=false;  objUti.mostrarMsgErr_F1(this, Evt);  }
     catch(Exception Evt) { blnRes=false;  objUti.mostrarMsgErr_F1(this, Evt);  }
    System.gc();
    return blnRes;
}




    private void butguaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_butguaActionPerformed
        // TODO add your handling code here:

        String strTit, strMsg;
        javax.swing.JOptionPane oppMsg=new javax.swing.JOptionPane();
        strTit="Mensaje del sistema Zafiro";
        strMsg="¿Está seguro que desea guardar ?";
        if (oppMsg.showConfirmDialog(this,strMsg,strTit,javax.swing.JOptionPane.YES_NO_OPTION,javax.swing.JOptionPane.QUESTION_MESSAGE)==javax.swing.JOptionPane.YES_OPTION) {
            guardarDat();
           
        }

    }//GEN-LAST:event_butguaActionPerformed


 private boolean guardarDat(){
  boolean blnRes=false;
  java.sql.Connection conn;
  try{
     conn=java.sql.DriverManager.getConnection(objZafParSis.getStringConexion(),objZafParSis.getUsuarioBaseDatos(),objZafParSis.getClaveBaseDatos());
     if(conn!=null){
       conn.setAutoCommit(false);

       if(actualizarReg(conn)){
           conn.commit();
           blnRes=true;

           enviarCorEleVentas();

           MensajeInf("Los datos se Guardar con éxito.. ");
       }else conn.rollback();


       conn.close();
       conn=null;
   }}catch(java.sql.SQLException Evt) { blnRes=false;  objUti.mostrarMsgErr_F1(this, Evt);  }
     catch(Exception Evt) { blnRes=false;  objUti.mostrarMsgErr_F1(this, Evt);  }

    System.gc();
    return blnRes;
}


public boolean actualizarReg(java.sql.Connection conn ){
   boolean blnRes=false;
   java.sql.Statement stmLoc;
   String strSql="";
   String strCodEmpAct="",strCodLoc="", strDiaVal="";
   try{
     stmLoc=conn.createStatement();

    for(int i=0; i<tblDat.getRowCount(); i++){

        strCodEmpAct=tblDat.getValueAt(i, INT_TBL_CODEMP).toString();
        strCodLoc=tblDat.getValueAt(i, INT_TBL_CODLOC).toString();
        strDiaVal=(tblDat.getValueAt(i, INT_TBL_DIAVAL)==null?"0":(tblDat.getValueAt(i, INT_TBL_DIAVAL).toString().equals("")?"0":tblDat.getValueAt(i, INT_TBL_DIAVAL).toString()));

        strSql +=" UPDATE tbm_loc SET ne_diavalcotven="+strDiaVal+", fe_moddiavalcotven="+objZafParSis.getFuncionFechaHoraBaseDatos()+", " +
        "  co_usrmoddiavalcotven="+objZafParSis.getCodigoUsuario()+", tx_commoddiavalcotven='"+objZafParSis.getNombreComputadoraConDirIP()+"' "+
        " WHERE co_emp="+strCodEmpAct+" " +
        " AND co_loc="+strCodLoc+" ; ";
    }

     if(!(strSql.equals("")))
       stmLoc.executeUpdate(strSql);

      stmLoc.close();
      stmLoc=null;
      blnRes=true;

   }catch(java.sql.SQLException Evt){ blnRes=false; objUti.mostrarMsgErr_F1(this, Evt); }
    catch(Exception Evt){ blnRes=false;  objUti.mostrarMsgErr_F1(this, Evt); }
    return blnRes;
}


public boolean enviarCorEleVentas(){
   boolean blnRes=false;
   int intCodEmp=0,intCodLoc=0, intDiaVal=0;
   try{
     
    for(int i=0; i<tblDat.getRowCount(); i++){

        intCodEmp=Integer.parseInt(objInvItm.getIntDatoValidado(tblDat.getValueAt(i, INT_TBL_CODEMP)));
        intCodLoc=Integer.parseInt(objInvItm.getIntDatoValidado(tblDat.getValueAt(i, INT_TBL_CODLOC)));
        intDiaVal=Integer.parseInt(objInvItm.getIntDatoValidado(tblDat.getValueAt(i, INT_TBL_DIAVAL)));

        if((intCodEmp==1)&&(intCodLoc==4)){  // TUVAL S.A.

            enviarCorEle(1, intDiaVal);

        }else if((intCodEmp==2)&&(intCodLoc==1)){  // QUITO

             enviarCorEle(2, intDiaVal);
            
        }else if((intCodEmp==2)&&(intCodLoc==4)){  // MANTA

            enviarCorEle(3, intDiaVal);


        }else if((intCodEmp==2)&&(intCodLoc==6)){  // SANTO DOMINGO

             enviarCorEle(4, intDiaVal);

        }else if((intCodEmp==4)&&(intCodLoc==3)){  // DIMULTI

             enviarCorEle(5, intDiaVal);
        
        }

    }

    
      blnRes=true;

   }catch(Exception Evt){ blnRes=false;  objUti.mostrarMsgErr_F1(this, Evt); }
    return blnRes;
}







/**
 * Funcion d envio de correo de electronico el cual recibe empresa de buqueda y el dia de validez
 * @param intTipEmp tipo de empresa el cual se buscara <br> 1 TUVAL <BR> 2 QUITO <BR> 3 MANTA <BR> 4 SANTO DOMINGO <BR> 5 DIMULTI
 * @param intDiaVal  dia de validez de la cotización
 * @return  true si todo esta correcto <br>   false si algo esta mal
 */
public boolean enviarCorEle(int intTipEmp, int intDiaVal){
   boolean blnRes=false;
   String strMensCorEle="";
   String strCorEleTo="";
   try{

     Librerias.ZafCorElePrg.ZafCorElePrg objCorEle=new Librerias.ZafCorElePrg.ZafCorElePrg(objZafParSis, this);
       strCorEleTo = objCorEle._getCoreleVentas(intTipEmp);
     objCorEle=null;
      
           
       //System.out.println("--> "+ strCorEleTo );

       strMensCorEle = " LOS DIAS DE VALIDEZ DE LA COTIZACION CAMBIO AHORA ES DE "+intDiaVal+" DIAS    " ;
       objInvItm.enviarCorreo(strCorEleTo, strMensCorEle );
       
       
      
   }catch(Exception Evt){ blnRes=false;  objUti.mostrarMsgErr_F1(this, Evt); }
    return blnRes;
}









    private void butcerrActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_butcerrActionPerformed
        // TODO add your handling code here:
      exitForm();
}//GEN-LAST:event_butcerrActionPerformed
 /**
     * Para salir de la pantalla en donde estamos y pide confirmacion de salidad.
     */
    private void exitForm(){

        String strTit, strMsg;
        javax.swing.JOptionPane oppMsg=new javax.swing.JOptionPane();
        strTit="Mensaje del sistema Zafiro";
        strMsg="¿Está seguro que desea cerrar este programa?";
        if (oppMsg.showConfirmDialog(this,strMsg,strTit,javax.swing.JOptionPane.YES_NO_OPTION,javax.swing.JOptionPane.QUESTION_MESSAGE)==javax.swing.JOptionPane.YES_OPTION)
        {
            dispose();
        }

    }
    
    private void txtCodEmpActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtCodEmpActionPerformed
        // TODO add your handling code here:
        txtCodEmp.transferFocus();
}//GEN-LAST:event_txtCodEmpActionPerformed

    private void txtCodEmpFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtCodEmpFocusGained
        // TODO add your handling code here:
        strCodEmp=txtCodEmp.getText();
        txtCodEmp.selectAll();
}//GEN-LAST:event_txtCodEmpFocusGained

    private void txtCodEmpFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtCodEmpFocusLost
        // TODO add your handling code here:

        if (!txtCodEmp.getText().equalsIgnoreCase(strCodEmp)) {
            if (txtCodEmp.getText().equals("")) {
                txtCodEmp.setText("");
                txtNomEmp.setText("");
            }else
                BuscarEmp("a.co_emp",txtCodEmp.getText(),1);
        }else
            txtCodEmp.setText(strCodEmp);
}//GEN-LAST:event_txtCodEmpFocusLost

    private void txtNomEmpActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtNomEmpActionPerformed
        // TODO add your handling code here:
        txtNomEmp.transferFocus();
}//GEN-LAST:event_txtNomEmpActionPerformed

    private void txtNomEmpFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtNomEmpFocusGained
        // TODO add your handling code here:
        strNomEmp=txtNomEmp.getText();
        txtNomEmp.selectAll();
}//GEN-LAST:event_txtNomEmpFocusGained

    private void txtNomEmpFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtNomEmpFocusLost
        // TODO add your handling code here:
        if (!txtNomEmp.getText().equalsIgnoreCase(strNomEmp)) {
            if (txtNomEmp.getText().equals("")) {
                txtCodEmp.setText("");
                txtNomEmp.setText("");
            }else
                BuscarEmp("a.tx_nom",txtNomEmp.getText(),2);
        }else
            txtNomEmp.setText(strNomEmp);
}//GEN-LAST:event_txtNomEmpFocusLost

    private void butEmpActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_butEmpActionPerformed
        // TODO add your handling code here:
        objVenConEmp.setTitle("Listado de Empresas");
        objVenConEmp.setCampoBusqueda(1);
        objVenConEmp.show();
        if (objVenConEmp.getSelectedButton()==objVenConEmp.INT_BUT_ACE) {
            txtCodEmp.setText(objVenConEmp.getValueAt(1));
            txtNomEmp.setText(objVenConEmp.getValueAt(2));
            strCodEmp=objVenConEmp.getValueAt(1);
            strNomEmp=objVenConEmp.getValueAt(2);
            if (objThrGUI==null) {
                objThrGUI=new ZafThreadGUI();
                objThrGUI.start();
            }
        }
}//GEN-LAST:event_butEmpActionPerformed

    private void formInternalFrameOpened(javax.swing.event.InternalFrameEvent evt) {//GEN-FIRST:event_formInternalFrameOpened
        // TODO add your handling code here:
        Configura_ventana_consulta();
        
    }//GEN-LAST:event_formInternalFrameOpened

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        // TODO add your handling code here:

       int intDiaVal = Integer.parseInt( spnDiaVal.getModel().getValue().toString() );
       if(intDiaVal < 0 ) intDiaVal=0;

       for(int i=0; i<tblDat.getRowCount(); i++){

           tblDat.setValueAt( ""+intDiaVal, i, INT_TBL_DIAVAL);

        }

       
    }//GEN-LAST:event_jButton1ActionPerformed

    private void formInternalFrameClosing(javax.swing.event.InternalFrameEvent evt) {//GEN-FIRST:event_formInternalFrameClosing
        // TODO add your handling code here:
        exitForm();
    }//GEN-LAST:event_formInternalFrameClosing



public void BuscarEmp(String campo,String strBusqueda,int tipo){
  objVenConEmp.setTitle("Listado de Empresas");
  if(objVenConEmp.buscar(campo, strBusqueda )) {
         txtCodEmp.setText(objVenConEmp.getValueAt(1));
         txtNomEmp.setText(objVenConEmp.getValueAt(2));
         strCodEmp=objVenConEmp.getValueAt(1);
         strNomEmp=objVenConEmp.getValueAt(2);

  }else{
        objVenConEmp.setCampoBusqueda(tipo);
        objVenConEmp.cargarDatos();
        objVenConEmp.show();
        if (objVenConEmp.getSelectedButton()==objVenConEmp.INT_BUT_ACE) {
            txtCodEmp.setText(objVenConEmp.getValueAt(1));
            txtNomEmp.setText(objVenConEmp.getValueAt(2));
            strCodEmp=objVenConEmp.getValueAt(1);
            strNomEmp=objVenConEmp.getValueAt(2);
         }else{
            txtCodEmp.setText(strCodEmp);
            txtNomEmp.setText(strNomEmp);
  }}}




    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton butCon;
    private javax.swing.JButton butEmp;
    private javax.swing.JButton butcerr;
    private javax.swing.JButton butgua;
    private javax.swing.JButton jButton1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JLabel lblMsgSis;
    private javax.swing.JLabel lblTit;
    private javax.swing.JPanel panBarEst;
    private javax.swing.JPanel panCabRecChq;
    private javax.swing.JPanel panCen;
    private javax.swing.JPanel panGenTabGen;
    private javax.swing.JPanel panNor;
    private javax.swing.JPanel panPrgSis;
    private javax.swing.JProgressBar pgrSis;
    private javax.swing.JScrollPane spnDat;
    private javax.swing.JSpinner spnDiaVal;
    private javax.swing.JTabbedPane tabGen;
    private javax.swing.JTable tblDat;
    private javax.swing.JTextField txtCodEmp;
    private javax.swing.JTextField txtNomEmp;
    // End of variables declaration//GEN-END:variables

}
